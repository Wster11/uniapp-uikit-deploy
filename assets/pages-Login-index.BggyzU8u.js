import{d as e,r as a,o as l,a as o,c as t,w as n,b as s,e as r,u as i,t as d,f as c,g as u,s as p,h as v,n as m,i as f,j as h,I as g,k as C,l as k,m as y,p as I,q as _,v as b,x as w,C as V,y as P,z as T}from"./index-BkrUuuud.js";import{t as x}from"./locales.BWIMgwgX.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";const U=S(e({__name:"index",setup(e){let S=!1;const U=a(60),F=a(null),j=a(""),E=a(""),N=a(""),B=a(""),K=a(!1),$=a(0),L=a(!!_),M=async()=>{if(!S)if(/^1[3456789]\d{9}$/.test(N.value))try{S=!0,F.value=setInterval((()=>{U.value--,U.value<=0&&(clearInterval(F.value),U.value=60,S=!1,F.value=null)}),1e3);const e=await v({url:`https://a1.easemob.com/inside/app/sms/send/${N.value}`,header:{"content-type":"application/json"},method:"POST",data:{phoneNumber:N.value}});200===e.statusCode?p({title:x("getCodeSuccess"),icon:"none"}):400===e.statusCode?O(e.data.errorInfo):p({title:x("getCodeFailed"),icon:"none"})}catch(e){console.error(e),p({title:x("getCodeFailed"),icon:"none"})}else p({title:x("telNumberError"),icon:"none"})},O=e=>{const a={"phone number illegal":x("telNumberError"),"Please wait a moment while trying to send.":x("getCodeFrequent"),"exceed the limit":x("getCodeReachLimit")};p({title:a[e]||e,icon:"none"})},q=()=>{K.value?L.value?(b({title:x("loginLoadingTitle")}),uni.$UIKIT.chatStore.login({user:j.value,pwd:E.value}).then((e=>{w({key:V,data:{userId:j.value,token:e.accessToken}}),P({url:"/ChatUIKIT/modules/Conversation/index"})})).catch((e=>{var a,l;p({title:null==(l=null==(a=null==e?void 0:e.data)?void 0:a.data)?void 0:l.error_description,icon:"none"})})).finally((()=>{T()}))):(async()=>{b({title:x("loginLoadingTitle")});try{const e=await v({url:"https://a1.easemob.com/inside/app/user/login/V2",header:{"content-type":"application/json"},method:"POST",data:{phoneNumber:N.value,smsCode:B.value}});if(200==e.statusCode){const{token:a,chatUserName:l}=e.data;uni.$UIKIT.chatStore.login({user:l,accessToken:a}).then((e=>{w({key:V,data:{userId:l,token:e.accessToken}}),P({url:"/ChatUIKIT/modules/Conversation/index"})})).finally((()=>{T()}))}else if(400==e.statusCode&&e.data.errorInfo)switch(e.data.errorInfo){case"UserId password error.":p({title:x("userIdOrPasswordError"),icon:"none"});break;case"phone number illegal":p({title:x("telNumberError"),icon:"none"});break;case"SMS verification code error.":p({title:x("codeError"),icon:"none"});break;case"Sms code cannot be empty":p({title:x("codeIsEmpty"),icon:"none"});break;case"Please send SMS to get mobile phone verification code.":p({title:x("getCodeFirst"),icon:"none"});break;default:p({title:e.data.errorInfo,icon:"none"})}}catch(e){console.log(e),p({title:x("loginFailed"),icon:"none"})}})():p({title:x("privacyChecked"),icon:"none"})},z=()=>{},D=e=>{K.value=!!e.detail.value[0]},A=()=>{m({url:"../ServerConfig/index"})};return l((()=>{F.value&&clearInterval(F.value)})),(e,a)=>{const l=f,p=h,v=g,m=C,b=k,w=y,V=I;return o(),t(p,{class:"login-wrap"},{default:n((()=>[s(p,{class:"login-header"},{default:n((()=>[s(l,{class:"login-title"},{default:n((()=>[r("登录环信IM")])),_:1}),s(p,{class:"version",onClick:a[0]||(a[0]=e=>$.value++)},{default:n((()=>[r("V1.0.0")])),_:1})])),_:1}),L.value?(o(),t(p,{key:0,class:"login-form-warp"},{default:n((()=>[s(p,{class:"input-wrap"},{default:n((()=>[s(v,{class:"input",modelValue:j.value,"onUpdate:modelValue":a[1]||(a[1]=e=>j.value=e),placeholder:i(x)("loginUserIdPlaceholder")},null,8,["modelValue","placeholder"])])),_:1}),s(p,{class:"input-wrap"},{default:n((()=>[s(v,{class:"input",type:"password",modelValue:E.value,"onUpdate:modelValue":a[2]||(a[2]=e=>E.value=e),placeholder:i(x)("loginPasswordPlaceholder")},null,8,["modelValue","placeholder"])])),_:1})])),_:1})):(o(),t(p,{key:1,class:"login-form-wrap"},{default:n((()=>[s(p,{class:"input-wrap"},{default:n((()=>[s(v,{class:"input",modelValue:N.value,"onUpdate:modelValue":a[3]||(a[3]=e=>N.value=e),maxlength:"11",placeholder:i(x)("loginPhoneIdPlaceholder")},null,8,["modelValue","placeholder"])])),_:1}),s(p,{class:"input-wrap"},{default:n((()=>[s(v,{class:"input",modelValue:B.value,"onUpdate:modelValue":a[4]||(a[4]=e=>B.value=e),maxlength:"6",placeholder:i(x)("loginCodePlaceholder")},null,8,["modelValue","placeholder"]),s(l,{size:"mini",type:"primary",class:"get-code",onClick:M},{default:n((()=>[r(d(60===U.value?i(x)("getCode"):U.value),1)])),_:1})])),_:1})])),_:1})),s(m,{class:"login-btn",type:"primary",onClick:q},{default:n((()=>[r(d(i(x)("login")),1)])),_:1}),s(p,{class:"private-wrap"},{default:n((()=>[s(V,{onChange:D},{default:n((()=>[s(w,{class:"label"},{default:n((()=>[s(b,{backgroundColor:"#f9fafa",borderColor:"#ACB4B9",activeBackgroundColor:"#009DFF",activeBorderColor:"#009DFF",style:{transform:"scale(0.8)"},iconColor:"#fff",value:"true",checked:K.value},null,8,["checked"]),r(" "+d(i(x)("agreeTo"))+" ",1),c("a",{class:"privacy",onClick:z},"《"+d(i(x)("privacyPolicy"))+"》",1)])),_:1})])),_:1})])),_:1}),$.value>5||i(_)?(o(),t(p,{key:2,class:"server-config",onClick:A},{default:n((()=>[r(d(i(x)("serverConfig")),1)])),_:1})):u("",!0)])),_:1})}}}),[["__scopeId","data-v-ab7f6f2d"]]);export{U as default};
