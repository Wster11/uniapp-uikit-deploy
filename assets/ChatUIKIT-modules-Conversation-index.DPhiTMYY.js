import{d as e,a,c as n,w as t,b as s,Q as o,J as l,L as r,K as i,u as c,e as u,t as p,R as v,h as d,r as m,H as f,v as g,s as C,o as A,x as h,g as w,T as _,V as y,z as k,G as S,W as x,X as I,Y as T,Z as M}from"./index-B8CRE7TD.js";import{A as U}from"./index.CDIGqLY9.js";import{N as j}from"./index.BT2yLek7.js";import{_ as K}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{S as b}from"./index.wM2NigoD.js";import{E as B}from"./index.Dx-9GcQl.js";const E=K(e({__name:"index",props:{popStyle:{},options:{}},emits:["onMenuTap","onMenuClose"],setup(e,{emit:m}){const f=m,g=e.options;return(e,m)=>{const C=v,A=d;return a(),n(A,{class:"mask",onClick:m[0]||(m[0]=e=>f("onMenuClose"))},{default:t((()=>[s(A,{class:"pop show",style:o(e.popStyle)},{default:t((()=>[(a(!0),l(r,null,i(c(g),((e,o)=>(a(),n(A,{class:"pop-menu-item",key:e.type,title:e.name,onClick:a=>{return n={type:e.type},f("onMenuTap",n),void f("onMenuClose");var n}},{default:t((()=>[s(A,{class:"icon"},{default:t((()=>[s(C,{class:"icon-img",src:e.icon},null,8,["src"])])),_:2},1024),s(A,null,{default:t((()=>[u(p(e.name),1)])),_:2},1024)])),_:2},1032,["title","onClick"])))),128))])),_:1},8,["style"])])),_:1})}}}),[["__scopeId","data-v-ccd6f783"]]),G=K(e({__name:"index",setup(e){const o=_+"icon/chat.png",l=_+"icon/addContact.png",r=_+"icon/createGroup.png",i=m(!1),u=y?{right:"40px",bottom:"calc(120px - var(--safe-area-inset-bottom))"}:{right:"25px",top:"calc(var(--status-bar-height) + 50px"},p=m({}),v=[{name:f("newChatButton"),type:"newConversation",icon:o},{name:f("addContact"),type:"addContact",icon:l},{name:f("createGroup"),type:"createGroup",icon:r}],k=g((()=>{p.value=C.appUserStore.getSelfUserInfo()})),S=e=>{switch(e.type){case"newConversation":uni.navigateTo({url:"/ChatUIKIT/modules/ChatNew/index"});break;case"createGroup":uni.navigateTo({url:"/ChatUIKIT/modules/GroupCreate/index"});break;case"addContact":uni.navigateTo({url:"/ChatUIKIT/modules/ContactAdd/index"})}};return A((()=>{k()})),(e,o)=>{const l=d;return a(),n(l,null,{default:t((()=>[s(j,{showBackArrow:!1},{left:t((()=>[s(U,{size:32,src:p.value.avatar,withPresence:!0,placeholder:c(h),presenceExt:p.value.presenceExt,isOnline:p.value.isOnline},null,8,["src","placeholder","presenceExt","isOnline"])])),center:t((()=>[s(l,{class:"title"})])),right:t((()=>[s(l,{class:"btn-wrap"},{default:t((()=>[s(l,{class:"action-btn",onClick:o[0]||(o[0]=e=>i.value=!0)})])),_:1})])),_:1}),i.value?(a(),n(E,{key:0,options:v,popStyle:c(u),onOnMenuTap:S,onOnMenuClose:o[1]||(o[1]=e=>i.value=!1)},null,8,["popStyle"])):w("",!0)])),_:1})}}}),[["__scopeId","data-v-87140721"]]),N=K(e({__name:"index",props:{conversation:{},showMenu:{type:Boolean}},emits:["mute","pin","delete","leftSwipe"],setup(e,{emit:_}){const y=e,M=_;let j=0;const K=m({}),b=m(!1),B=m(!1),E=C.getFeatureConfig(),G=e=>{var a;if("groupChat"===y.conversation.conversationType){const n=e.from||C.getChatConn().user,t=C.appUserStore.getUserInfoFromStore(n).nickname;return t||((null==(a=e.ext)?void 0:a.ease_chat_uikit_user_info.nickname)?e.ext.ease_chat_uikit_user_info.nickname:n)}return""},N=k((()=>{let e=[];return E.muteConversation&&e.push({name:b.value?f("unmute"):f("mute"),action:"mute",class:"mute"}),E.pinConversation&&e.push({name:y.conversation.isPinned?f("unpin"):f("pin"),action:"pin",class:"pin"}),E.deleteConversation&&e.push({name:f("deleteConv"),action:"delete",class:"delete"}),e})),P=m([{name:f("confirmDeleteConv"),action:"confirmDelete",class:"confirm-delete"}]),O=k((()=>B.value?P.value:N.value)),F=g((()=>{b.value=C.convStore.getConversationMuteStatus(y.conversation.conversationId)})),H=g((()=>{const e=y.conversation.conversationId;if("groupChat"!==y.conversation.conversationType)return K.value=C.appUserStore.getUserInfoFromStore(e);{const a=C.groupStore.getGroupInfoFromStore(e);K.value={name:(null==a?void 0:a.groupName)||e,avatar:C.groupStore.getGroupAvatar(e)}}})),{getConversationTime:Q}=C.convStore,R=()=>{if(y.showMenu)return B.value=!1,void M("leftSwipe",null);uni.navigateTo({url:`/ChatUIKIT/modules/Chat/index?type=${y.conversation.conversationType}&id=${y.conversation.conversationId}`})},X=e=>{j=e.touches[0].pageX},Y=e=>{if(0===N.value.length)return;const a=e.touches[0].pageX-j;Math.abs(a)<60||(a>0?(M("leftSwipe",null),B.value=!1):M("leftSwipe",y.conversation.conversationId))};return A((()=>{H(),F()})),(e,m)=>{const g=d,C=v;return a(),n(g,{class:"swipe-menu-wrap",onTouchmove:Y,onTouchstart:X,style:o({transform:`translateX(${y.showMenu?-272:0}px)`})},{default:t((()=>[s(g,{class:S(["conversation-item-wrap",{"pin-conversation-item-wrap":y.conversation.isPinned}]),onClick:R},{default:t((()=>[s(g,{class:"avatar-wrap"},{default:t((()=>[s(U,{src:K.value.avatar,placeholder:"groupChat"===y.conversation.conversationType?I:h},null,8,["src","placeholder"])])),_:1}),s(g,{class:"content-wrap"},{default:t((()=>[s(g,{class:"user-info-wrap"},{default:t((()=>[s(g,{class:"info-wrap"},{default:t((()=>[s(g,{class:"user-nick-name ellipsis"},{default:t((()=>[u(p(K.value.name),1)])),_:1}),b.value?(a(),n(C,{key:0,style:{width:"20px",height:"20px"},src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJXSURBVHgB7ZhdUtswEMdXknmuewPfoL1B2xtwgiSeKfQtwSdIcgIH0plOAzNO6AEKJ4AjwAngCPCOJFZOGBhGtlax7Acm/yeNbK9+Xn3tLsBOH1wMAikvilgoMTZtyeU0S9MHCKAIAolLPtFaj8q25ubHjyCAggGChvilyYB9on72+2zVlxpmjLGL4c9e+v45hwAy04sDvEIpiE2f67sN3BKbsQb93fbO1mvQAERP0cgYrjKOumGaHcs9eY1r8h7scKWUVml2mC6DAM7P/u2jwQKbTi9tRrlnik2Hh72lD5yR9xTPT1djNPifDGekIZFMJ75wRl4eLOEAJuAp/GaaHfQnvnBegPmfIuERvwNPNYEzIk+x2Fsfwl3CkQGN9/AQHoCHXHCUY4gMKCLYBw+54Ey/uXkotmhTzMQ3IIoCV/YrSCj2aICadqSQ4dYjf6HYJAHi+ktc73jBeSjIXdwWXBDANuEaA7YN1wiwC7itAbuC2wqwSzgjZ7DwNkgIDaci9dmVXDk9GEW83wZcOfgTdyZWtR7MF8VXzvgVwh23NK0PaOMH2ripeqHSg/PFatQynFFsxjj5e17pSasHTxbnA8100eWGwJwlG/7qzd73Wz2IWdq4692qxTrpJwEqBqsu4daE9vCrcpPURMKJkP7hv0tSy9vsIJ2RAJvkEKFlrc1IhanlBr0OrqxoSZFDjaSQWZNKl714xOES10Qf4TKX5zCYNfmKPeLGikLTMlzj+mB+Whxx4FYvKsAftKwrHwUpYJY3DueDl7IbHlOP6P0LhLuGnXaq1zNn5U+xxF6QfgAAAABJRU5ErkJggg=="})):w("",!0)])),_:1}),s(g,{class:"msg-wrap"},{default:t((()=>{var s;return[e.conversation.atType&&"NONE"!==e.conversation.atType?(a(),n(g,{key:0,class:"mention-tag"},{default:t((()=>[u(p("ALL"===e.conversation.atType?c(f)("atAllTag"):c(f)("atTag")),1)])),_:1})):w("",!0),"txt"===(null==(s=e.conversation.lastMessage)?void 0:s.type)?(a(),n(g,{key:1,class:"last-msg ellipsis"},{default:t((()=>{var t;return["groupChat"!==e.conversation.conversationType||(null==(t=e.conversation.lastMessage)?void 0:t.noticeInfo)?w("",!0):(a(),l("span",{key:0},p(G(e.conversation.lastMessage))+": ",1)),(a(!0),l(r,null,i(c(x)(e.conversation.lastMessage.msg),((e,t)=>(a(),l("span",{class:S([{"emoji-wrap":"text"!==e.type}]),key:t},["text"===e.type?(a(),l("span",{key:0},p(e.value),1)):(a(),n(C,{key:1,class:"msg-emoji",src:e.value},null,8,["src"]))],2)))),128))]})),_:1})):(a(),n(g,{key:2,class:"last-msg ellipsis"},{default:t((()=>{return[u(p((a=e.conversation,T(a.lastMessage))),1)];var a})),_:1}))]})),_:1})])),_:1}),s(g,{class:"msg-right-wrap"},{default:t((()=>[s(g,{class:"time"},{default:t((()=>[u(p(c(Q)(e.conversation.lastMessage)),1)])),_:1}),s(g,{class:S(e.conversation.unReadCount?"":"hidden")},{default:t((()=>[b.value?(a(),n(g,{key:0,class:"unread-mute"})):(a(),n(g,{key:1,class:"unread-count"},{default:t((()=>[u(p(e.conversation.unReadCount>99?"99+":e.conversation.unReadCount),1)])),_:1}))])),_:1},8,["class"])])),_:1})])),_:1})])),_:1},8,["class"]),s(g,{class:"menu-wrap"},{default:t((()=>[(a(!0),l(r,null,i(O.value,(e=>(a(),n(g,{class:S(["menu",e.class]),key:e.action,onClick:a=>(e=>{if("mute"===e)M("mute",y.conversation);else if("pin"===e)M("pin",y.conversation);else{if("delete"===e)return void(B.value=!0);"confirmDelete"===e&&M("delete",y.conversation)}M("leftSwipe",null),B.value=!1})(e.action)},{default:t((()=>[u(p(e.name),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1},8,["style"])}}}),[["__scopeId","data-v-5472146f"]]),P=K(e({__name:"index",setup(e){const o=m(null),u=m([]),p=m({}),v=g((()=>{u.value=M(C.convStore.conversationList)})),f=g((()=>{p.value=C.appUserStore.getSelfUserInfo()})),h=e=>{C.convStore.deleteConversation(e)},_=e=>{C.convStore.pinConversation(e,!e.isPinned)},k=e=>{C.convStore.getConversationMuteStatus(e.conversationId)?(e=>{C.convStore.clearRemindTypeForConversation(e)})(e):(e=>{C.convStore.setSilentModeForConversation(e)})(e)},x=e=>{o.value=e},I=()=>{uni.navigateTo({url:"/ChatUIKIT/modules/ConversationSearchList/index"})};return A((()=>{v(),f()})),(e,p)=>{const v=d;return a(),n(v,{class:"conversation-list-wrap"},{default:t((()=>[s(v,{class:"conversation-list-content"},{default:t((()=>[s(v,{class:"header-wrap"},{default:t((()=>[s(G),s(b,{class:"convs-search-btn",onClick:I})])),_:1}),s(v,{class:S(c(y)?"wx-block":"block")},null,8,["class"]),u.value.length?(a(),n(v,{key:0,class:"convs-wrap"},{default:t((()=>[(a(!0),l(r,null,i(u.value,(e=>(a(),n(v,{key:e.conversationId,"data-id":e.conversationId},{default:t((()=>[s(N,{conversation:e,showMenu:!!o.value&&o.value===e.conversationId,onMute:k,onPin:_,onDelete:h,onLeftSwipe:x},null,8,["conversation","showMenu"])])),_:2},1032,["data-id"])))),128))])),_:1})):w("",!0),u.value.length?w("",!0):(a(),n(B,{key:1}))])),_:1})])),_:1})}}}),[["__scopeId","data-v-c70f8f53"]]),O=K(e({__name:"index",setup:e=>(e,t)=>(a(),n(P))}),[["__scopeId","data-v-91859204"]]);export{O as default};
